<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>–ß—Ç–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å?</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #ffecd2, #fcb69f);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      color: #222;
      padding: 24px 16px;
    }
    .card {
      width: 100%;
      max-width: 560px;
      background: rgba(255,255,255,.96);
      border-radius: 26px;
      padding: 32px 28px;
      box-shadow: 0 30px 70px rgba(0,0,0,.18);
    }
    .back-btn {
      padding: 14px 24px;
      background: linear-gradient(135deg, #a0d8ef, #b8e0f8);
      color: #222;
      width: 100%;
      border: none;
      border-radius: 40px;
      cursor: pointer;
      font-weight: 800;
      margin-bottom: 20px;
      font-size: 16px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    h1 {
      font-size: 26px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 20px;
      color: #d35400;
    }
    .category-select {
      margin-bottom: 24px;
      text-align: center;
    }
    .category-btn {
      padding: 12px 24px;
      margin: 6px;
      border: none;
      border-radius: 40px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      background: #eee;
      color: #444;
      transition: all 0.2s;
    }
    .category-btn.active {
      background: linear-gradient(135deg, #f6d365, #fda085);
      color: #222;
      font-weight: 700;
    }
    .ingredients-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
      margin-bottom: 24px;
    }
    .ingredient-item {
      display: flex; align-items: center; gap: 8px;
      padding: 10px;
      background: #fdfaf7;
      border: 1px solid #f4d3b5;
      border-radius: 12px;
      cursor: pointer;
      font-size: 14px;
      transition: 0.2s;
    }
    .ingredient-item:has(input:checked) {
      background: #fff8f2;
      border-color: #f4a261;
    }
    .main-btn {
      padding: 18px;
      background: linear-gradient(135deg, #f6d365, #fda085);
      width: 100%;
      border-radius: 40px;
      border: none;
      font-weight: 700;
      font-size: 17px;
      cursor: pointer;
      margin-bottom: 12px;
    }
    .main-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .refresh-btn {
      padding: 16px;
      background: linear-gradient(135deg, #4caf50, #66bb6a);
      color: white;
      width: 100%;
      border-radius: 40px;
      border: none;
      font-weight: 700;
      cursor: pointer;
      display: none;
      margin-bottom: 20px;
    }
    .counter {
      text-align: center;
      color: #555;
      margin: 16px 0;
      font-size: 15px;
    }
    .recipe-card {
      background: white;
      border-radius: 20px;
      overflow: hidden;
      border: 1px solid #eee;
      margin-top: 16px;
      animation: fadeIn 0.4s ease;
    }
    @keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }
    .recipe-card img {
      width: 100%;
      height: 220px;
      object-fit: cover;
    }
    .recipe-info {
      padding: 20px;
    }
    .recipe-title {
      font-size: 22px;
      font-weight: 700;
      color: #d35400;
      margin-bottom: 10px;
    }
    .ing-tag {
      padding: 5px 10px;
      border-radius: 8px;
      font-size: 13px;
      display: inline-block;
      margin: 4px 4px 4px 0;
    }
    .have           { background: #e3fcef; color: #27ae60; font-weight: 600; }
    .missing-main   { background: #ffe3e3; color: #c0392b; border: 1px solid #ffcccc; font-weight: 700; }
    .missing-extra  { background: #f1f2f6; color: #95a5a6; text-decoration: line-through; opacity: 0.75; }
    .steps-box {
      margin-top: 16px;
      font-size: 15px;
      line-height: 1.6;
      color: #444;
      border-top: 1px solid #eee;
      padding-top: 12px;
    }
    .error-msg {
      text-align: center;
      padding: 30px;
      color: #c0392b;
      font-size: 15px;
    }
  </style>
</head>
<body>

<div class="card">
  <button class="back-btn" onclick="window.history.back()">‚Üê –ù–∞–∑–∞–¥</button>
  <h1>–ß—Ç–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å?</h1>

  <div class="category-select" id="categorySelect">
    <button class="category-btn active" data-cat="breakfast">–ó–∞–≤—Ç—Ä–∞–∫</button>
    <button class="category-btn" data-cat="soups">–°—É–ø—ã</button>
    <button class="category-btn" data-cat="lunch">–û–±–µ–¥</button>
    <button class="category-btn" data-cat="dinner">–£–∂–∏–Ω</button>
    <button class="category-btn" data-cat="dessert">–î–µ—Å–µ—Ä—Ç—ã</button>
  </div>

  <div class="ingredients-grid" id="ingredientsList"></div>
  
  <button class="main-btn" id="findBtn" disabled>–ù–∞–π—Ç–∏ —Ä–µ—Ü–µ–ø—Ç</button>
  <button class="refresh-btn" id="refreshBtn">–î—Ä—É–≥–æ–π –≤–∞—Ä–∏–∞–Ω—Ç</button>

  <div id="counter" class="counter"></div>
  <div id="results"></div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const CATEGORIES = {
  breakfast: "recipes/breakfast.json",
  soups:     "recipes/soups.json",
  lunch:     "recipes/lunch.json",
  dinner:    "recipes/dinner.json",
  dessert:   "recipes/dessert.json"
};

const CATALOG = [
  {id: "eggs",              name: "–Ø–π—Ü–∞"},
  {id: "mushrooms",         name: "–ì—Ä–∏–±—ã"},
  {id: "onion",             name: "–õ—É–∫"},
  {id: "bran",              name: "–û—Ç—Ä—É–±–∏"},
  {id: "cottage_cheese",    name: "–¢–≤–æ—Ä–æ–≥"},
  {id: "cottage_cheese_soft",name: "–ú—è–≥–∫–∏–π —Ç–≤–æ—Ä–æ–≥"},
  {id: "lavash",            name: "–õ–∞–≤–∞—à"},
  {id: "cheese",            name: "–¢–≤—ë—Ä–¥—ã–π —Å—ã—Ä"},
  {id: "tomato_cherry",     name: "–ü–æ–º–∏–¥–æ—Ä—ã —á–µ—Ä—Ä–∏ / —Ç–æ–º–∞—Ç—ã"},
  {id: "fish_trout",        name: "–†—ã–±–∞ —Å–ª–∞–±–æ—Å–æ–ª—ë–Ω–∞—è / —Ñ–æ—Ä–µ–ª—å"},
  {id: "chicken",           name: "–ö—É—Ä–∏—Ü–∞"},
  {id: "potato",            name: "–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å"},
  {id: "carrot",            name: "–ú–æ—Ä–∫–æ–≤—å"},
  {id: "rice",              name: "–†–∏—Å"},
  {id: "pasta",             name: "–ú–∞–∫–∞—Ä–æ–Ω—ã / –ø–∞—Å—Ç–∞"},
  // –¥–æ–±–∞–≤–ª—è–π —Å—é–¥–∞ –¥—Ä—É–≥–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –ø–æ –º–µ—Ä–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –≤ —Ä–µ—Ü–µ–ø—Ç–∞—Ö
];

let selectedCategory = "breakfast";
let selectedIngredients = new Set();
let foundRecipes = [];
let currentIdx = 0;

function initCategoryButtons() {
  document.querySelectorAll('.category-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      selectedCategory = btn.dataset.cat;
      resetSearch();
    });
  });
}

function resetSearch() {
  selectedIngredients.clear();
  foundRecipes = [];
  currentIdx = 0;
  document.getElementById('findBtn').disabled = true;
  document.getElementById('refreshBtn').style.display = 'none';
  document.getElementById('counter').innerHTML = '';
  document.getElementById('results').innerHTML = '';
  renderIngredients();
}

function renderIngredients() {
  const grid = document.getElementById('ingredientsList');
  grid.innerHTML = CATALOG.map(i => `
    <label class="ingredient-item">
      <input type="checkbox" value="${i.id}" 
             onchange="toggleIng('${i.id}')"
             ${selectedIngredients.has(i.id) ? 'checked' : ''}>
      <span>${i.name}</span>
    </label>
  `).join('');
}

function toggleIng(id) {
  if (selectedIngredients.has(id)) {
    selectedIngredients.delete(id);
  } else {
    selectedIngredients.add(id);
  }
  document.getElementById('findBtn').disabled = selectedIngredients.size === 0;
  document.getElementById('refreshBtn').style.display = 'none';
  document.getElementById('counter').innerHTML = '';
  document.getElementById('results').innerHTML = '';
}

async function findRecipes() {
  const url = CATEGORIES[selectedCategory];
  if (!url) {
    showError("–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞");
    return;
  }

  try {
    const response = await fetch(url);
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    const recipes = await response.json();

    foundRecipes = recipes.filter(r => {
      const mains = r.ingredients.filter(i => i.isMain === true);
      if (mains.length === 0) return false;
      const matchedCount = mains.filter(i => selectedIngredients.has(i.id)).length;
      return (matchedCount / mains.length) >= 0.6;
    }).sort(() => Math.random() - 0.5);

    currentIdx = 0;
    updateCounterAndRender();

  } catch (err) {
    console.error(err);
    showError(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å ${selectedCategory}.json<br>${err.message}`);
  }
}

function showError(msg) {
  document.getElementById('results').innerHTML = `<div class="error-msg">${msg}</div>`;
}

function updateCounterAndRender() {
  const counterEl = document.getElementById('counter');
  const resultsEl = document.getElementById('results');

  if (foundRecipes.length === 0) {
    counterEl.innerHTML = '';
    resultsEl.innerHTML = '<p style="text-align:center; padding:30px; color:#666;">–ü–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—à–ª–æ—Å—å –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.</p>';
    document.getElementById('refreshBtn').style.display = 'none';
    return;
  }

  counterEl.innerHTML = `–ù–∞–π–¥–µ–Ω–æ ${foundRecipes.length} —Ä–µ—Ü–µ–ø—Ç${foundRecipes.length === 1 ? '' : '–∞/–æ–≤'} ¬∑ ${currentIdx + 1} –∏–∑ ${foundRecipes.length}`;
  document.getElementById('refreshBtn').style.display = foundRecipes.length > 1 ? 'block' : 'none';

  renderRecipe(foundRecipes[currentIdx]);
}

function renderRecipe(recipe) {
  const tags = recipe.ingredients.map(ing => {
    const has = selectedIngredients.has(ing.id);
    let cls = has ? 'have' : (ing.isMain ? 'missing-main' : 'missing-extra');
    let text = ing.name;
    if (!has && ing.isMain) text += " (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å / –±–µ–∑ –Ω–µ–≥–æ)";
    return `<span class="ing-tag ${cls}">${text}</span>`;
  }).join(' ');

  document.getElementById('results').innerHTML = `
    <div class="recipe-card">
      <img src="${recipe.photo}" onerror="this.src='https://via.placeholder.com/500x220?text=–ù–µ—Ç+—Ñ–æ—Ç–æ'" alt="${recipe.title}">
      <div class="recipe-info">
        <div class="recipe-title">${recipe.title}</div>
        <p style="color:#666; font-size:14px; margin-bottom:12px;">‚è± ${recipe.time} ‚ÄÉüî• ${recipe.calories} –∫–∫–∞–ª</p>
        <div>${tags}</div>
        <div class="steps-box">
          <strong>–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ:</strong><br>
          ${recipe.steps.map((s,i) => `${i+1}. ${s}`).join('<br>')}
        </div>
      </div>
    </div>
  `;
}

// ‚îÄ‚îÄ‚îÄ –°–æ–±—ã—Ç–∏—è ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('findBtn').onclick = findRecipes;

document.getElementById('refreshBtn').onclick = () => {
  currentIdx = (currentIdx + 1) % foundRecipes.length;
  updateCounterAndRender();
};

initCategoryButtons();
renderIngredients();
</script>
</body>
</html>
