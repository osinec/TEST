<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>–ß—Ç–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å?</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #ffecd2, #fcb69f);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      color: #222;
      padding: 24px 16px;
    }
    .card {
      width: 100%;
      max-width: 560px;
      background: rgba(255,255,255,.96);
      border-radius: 26px;
      padding: 32px 28px;
      box-shadow: 0 30px 70px rgba(0,0,0,.18);
    }
    .back-btn {
      padding: 14px 24px;
      background: linear-gradient(135deg, #a0d8ef, #b8e0f8);
      color: #222;
      width: 100%;
      border: none;
      border-radius: 40px;
      cursor: pointer;
      font-weight: 800;
      margin-bottom: 20px;
      font-size: 16px;
      text-transform: uppercase;
    }
    h1 {
      font-size: 26px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 20px;
      color: #d35400;
    }
    .ingredients-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(138px, 1fr));
      gap: 10px;
      margin-bottom: 24px;
    }
    .ingredient-item {
      display: flex; align-items: center; gap: 8px;
      padding: 10px 12px;
      background: #fdfaf7;
      border: 1px solid #f4d3b5;
      border-radius: 12px;
      cursor: pointer;
      font-size: 14px;
      transition: 0.18s;
    }
    .ingredient-item:has(input:checked) {
      background: #fff8f2;
      border-color: #f4a261;
    }
    .main-btn {
      padding: 18px;
      background: linear-gradient(135deg, #f6d365, #fda085);
      width: 100%;
      border: none;
      border-radius: 40px;
      font-weight: 700;
      font-size: 17px;
      cursor: pointer;
      margin-bottom: 12px;
    }
    .main-btn:disabled { opacity: 0.48; cursor: not-allowed; }
    .refresh-btn {
      padding: 16px;
      background: linear-gradient(135deg, #66bb6a, #4caf50);
      color: white;
      width: 100%;
      border: none;
      border-radius: 40px;
      font-weight: 700;
      cursor: pointer;
      display: none;
      margin-bottom: 20px;
    }
    .counter {
      text-align: center;
      color: #555;
      margin: 16px 0;
      font-size: 15px;
    }
    .recipe-card {
      background: white;
      border-radius: 20px;
      overflow: hidden;
      border: 1px solid #eee;
      margin-top: 16px;
      animation: fadeIn 0.4s ease;
    }
    @keyframes fadeIn { from {opacity:0; transform:translateY(12px);} to {opacity:1; transform:translateY(0);} }
    .recipe-card img {
      width: 100%;
      height: 210px;
      object-fit: cover;
    }
    .recipe-info { padding: 20px; }
    .recipe-title {
      font-size: 22px;
      font-weight: 700;
      color: #d35400;
      margin-bottom: 10px;
    }
    .ing-tag {
      padding: 5px 10px;
      border-radius: 8px;
      font-size: 13px;
      display: inline-block;
      margin: 4px 4px 4px 0;
      line-height: 1.4;
    }
    .have              { background:#e8f5e9; color:#2e7d32; font-weight:600; }
    .missing-essential { background:#ffebee; color:#c62828; border:2px solid #ef9a9a; font-weight:700; }
    .missing-important { background:#fff3e0; color:#e65100; border:1px solid #ffcc80; font-weight:600; }
    .missing-extra     { background:#f5f5f5; color:#757575; text-decoration:line-through; opacity:0.8; }
    .steps-box {
      margin-top: 16px;
      font-size: 15px;
      line-height: 1.55;
      color: #333;
      border-top: 1px solid #eee;
      padding-top: 12px;
    }
    .error-msg {
      text-align: center;
      padding: 32px 16px;
      color: #c62828;
      font-size: 15px;
    }
  </style>
</head>
<body>

<div class="card">
  <button class="back-btn" onclick="window.history.back()">‚Üê –ù–∞–∑–∞–¥</button>
  <h1>–ß—Ç–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å?</h1>

  <div class="ingredients-grid" id="ingredientsList"></div>
  
  <button class="main-btn" id="findBtn" disabled>–ù–∞–π—Ç–∏ —Ä–µ—Ü–µ–ø—Ç</button>
  <button class="refresh-btn" id="refreshBtn">–î—Ä—É–≥–æ–π –≤–∞—Ä–∏–∞–Ω—Ç</button>

  <div id="counter" class="counter"></div>
  <div id="results"></div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const RECIPES_URL = "recipes/all.json";  // ‚Üê –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø—É—Ç—å/–∏–º—è —Ñ–∞–π–ª–∞

const INGREDIENTS_CATALOG = [
  {id: "eggs",              name: "–Ø–π—Ü–∞"},
  {id: "mushrooms",         name: "–ì—Ä–∏–±—ã"},
  {id: "onion",             name: "–õ—É–∫"},
  {id: "bran",              name: "–û—Ç—Ä—É–±–∏"},
  {id: "cottage_cheese",    name: "–¢–≤–æ—Ä–æ–≥"},
  {id: "cottage_cheese_soft",name: "–ú—è–≥–∫–∏–π —Ç–≤–æ—Ä–æ–≥"},
  {id: "lavash",            name: "–õ–∞–≤–∞—à"},
  {id: "cheese",            name: "–¢–≤—ë—Ä–¥—ã–π —Å—ã—Ä"},
  {id: "tomato_cherry",     name: "–ü–æ–º–∏–¥–æ—Ä—ã / —á–µ—Ä—Ä–∏"},
  {id: "fish_trout",        name: "–§–æ—Ä–µ–ª—å / –∫—Ä–∞—Å–Ω–∞—è —Ä—ã–±–∞"},
  {id: "yogurt_greek",      name: "–ì—Ä–µ—á–µ—Å–∫–∏–π –π–æ–≥—É—Ä—Ç"},
  {id: "spinach",           name: "–®–ø–∏–Ω–∞—Ç"},
  {id: "butter",            name: "–°–ª–∏–≤–æ—á–Ω–æ–µ –º–∞—Å–ª–æ"},
  // –¥–æ–±–∞–≤–ª—è–π—Ç–µ –¥—Ä—É–≥–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
];

let selected = new Set();
let foundRecipes = [];
let currentIndex = 0;

function renderIngredients() {
  const grid = document.getElementById('ingredientsList');
  grid.innerHTML = INGREDIENTS_CATALOG.map(item => `
    <label class="ingredient-item">
      <input type="checkbox" value="${item.id}"
             onchange="toggleIng('${item.id}')"
             ${selected.has(item.id) ? 'checked' : ''}>
      <span>${item.name}</span>
    </label>
  `).join('');
}

function toggleIng(id) {
  if (selected.has(id)) selected.delete(id);
  else selected.add(id);

  document.getElementById('findBtn').disabled = selected.size === 0;
  document.getElementById('refreshBtn').style.display = 'none';
  document.getElementById('counter').textContent = '';
  document.getElementById('results').innerHTML = '';
}

async function findRecipes() {
  try {
    const res = await fetch(RECIPES_URL);
    if (!res.ok) throw new Error(`HTTP ${res.status} ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞`);
    const recipes = await res.json();

    foundRecipes = recipes.filter(r => {
      const essentials = r.ingredients.filter(i => i.essential === true);
      if (essentials.length === 0) return false;
      const matchedCount = essentials.filter(i => selected.has(i.id)).length;
      return matchedCount === essentials.length;
    }).sort(() => Math.random() - 0.5);

    currentIndex = 0;
    updateView();

  } catch (err) {
    console.error(err);
    document.getElementById('results').innerHTML = 
      `<div class="error-msg">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—Ü–µ–ø—Ç–æ–≤<br>${err.message}</div>`;
  }
}

function updateView() {
  const counterEl = document.getElementById('counter');
  const resultsEl = document.getElementById('results');

  if (foundRecipes.length === 0) {
    counterEl.textContent = '';
    resultsEl.innerHTML = '<p style="text-align:center; padding:32px 16px; color:#555;">–ü–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤ –Ω–µ—Ç</p>';
    document.getElementById('refreshBtn').style.display = 'none';
    return;
  }

  counterEl.textContent = `–ù–∞–π–¥–µ–Ω–æ ${foundRecipes.length} —Ä–µ—Ü–µ–ø—Ç${foundRecipes.length === 1 ? '' : '–∞/–æ–≤'} ¬∑ ${currentIndex + 1} / ${foundRecipes.length}`;
  document.getElementById('refreshBtn').style.display = foundRecipes.length > 1 ? 'block' : 'none';

  const recipe = foundRecipes[currentIndex];
  const tags = recipe.ingredients.map(ing => {
    const has = selected.has(ing.id);
    let cls = has ? 'have' : 'missing-extra';
    let text = ing.name;
    let prefix = '';

    if (ing.essential) {
      cls = has ? 'have' : 'missing-essential';
      if (!has) {
        prefix = '‚úó ';
        text += ' (–Ω–µ—Ç)';
      }
    } else if (ing.important) {
      cls = has ? 'have' : 'missing-important';
      if (!has) text += ' (–º–æ–∂–Ω–æ –±–µ–∑)';
    } else if (!has) {
      text = '‚Äì ' + text;
    }

    return `<span class="ing-tag ${cls}">${prefix}${text}</span>`;
  }).join(' ');

  resultsEl.innerHTML = `
    <div class="recipe-card">
      <img src="${recipe.photo}" onerror="this.src='https://via.placeholder.com/500x210?text=–ù–µ—Ç+—Ñ–æ—Ç–æ'" alt="${recipe.title}">
      <div class="recipe-info">
        <div class="recipe-title">${recipe.title}</div>
        <p style="color:#666; font-size:14px; margin:8px 0 12px;">‚è± ${recipe.time} ‚ÄÉüî• ${recipe.calories} –∫–∫–∞–ª</p>
        <div style="margin:12px 0;">${tags}</div>
        <div class="steps-box">
          <strong>–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ:</strong><br>
          ${recipe.steps.map((s,i) => `${i+1}. ${s}`).join('<br>')}
        </div>
      </div>
    </div>
  `;
}

// ‚îÄ‚îÄ‚îÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–æ–±—ã—Ç–∏—è ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('findBtn').onclick = findRecipes;

document.getElementById('refreshBtn').onclick = () => {
  currentIndex = (currentIndex + 1) % foundRecipes.length;
  updateView();
};

renderIngredients();
</script>
</body>
</html>
