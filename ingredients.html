<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>–†–µ—Ü–µ–ø—Ç—ã –ø–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: linear-gradient(135deg, #ffecd2, #fcb69f);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      color: #222;
      padding: 30px 16px;
    }
    .card {
      width: 100%;
      max-width: 540px;
      background: rgba(255,255,255,.96);
      border-radius: 26px;
      padding: 32px 28px;
      box-shadow: 0 30px 70px rgba(0,0,0,.18);
    }
    h1 {
      font-size: 26px;
      font-weight: 700;
      text-align: center;
      margin: 0 0 28px;
      line-height: 1.3;
      color: #d35400;
    }
    .section-title {
      text-align: left;
      font-size: 17px;
      font-weight: 600;
      color: #333;
      margin: 24px 0 14px;
    }
    .ingredients-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(148px, 1fr));
      gap: 10px 12px;
      margin-bottom: 20px;
    }
    .ingredient-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 14px;
      background: #fdfaf7;
      border: 1px solid #f4d3b5;
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.22s;
      user-select: none;
    }
    .ingredient-item:hover {
      background: #fff8f2;
      border-color: #f4a261;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(244,162,97,0.12);
    }
    .ingredient-item input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: #f4a261;
    }
    .ingredient-item span {
      font-size: 15px;
      line-height: 1.4;
      color: #444;
    }
    button {
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      border: none;
      border-radius: 40px;
      font-weight: 600;
      transition: all .3s;
      -webkit-tap-highlight-color: transparent;
    }
    .main-btn {
      padding: 18px 32px;
      background: linear-gradient(135deg, #f6d365, #fda085);
      font-size: 17px;
      color: #222;
      width: 100%;
      margin: 16px 0 12px;
    }
    .main-btn:disabled {
      opacity: 0.55;
      cursor: not-allowed;
    }
    .main-btn:not(:disabled):hover,
    .main-btn:not(:disabled):active {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0,0,0,.15);
    }
    .secondary-btn {
      padding: 16px 28px;
      background: linear-gradient(135deg, #e0e0e0, #d0d0d0);
      color: #444;
      font-size: 16px;
      width: 100%;
    }
    .secondary-btn:hover {
      background: linear-gradient(135deg, #d0d0d0, #c0c0c0);
    }
    .recipe-card {
      background: #fffef9;
      border-radius: 16px;
      padding: 20px;
      margin: 24px 0;
      border: 1px solid #f0e8e0;
      box-shadow: 0 6px 16px rgba(0,0,0,0.07);
    }
    .recipe-title {
      font-size: 21px;
      font-weight: 700;
      color: #c7903d;
      margin-bottom: 12px;
    }
    .recipe-meta {
      font-size: 14.5px;
      color: #666;
      margin-bottom: 16px;
      line-height: 1.5;
    }
    .plain-list {
      text-align: left;
      font-size: 15.5px;
      line-height: 1.65;
      color: #333;
      margin: 12px 0 20px;
      white-space: pre-wrap;
    }
    .note {
      text-align: left;
      margin-top: 20px;
      font-size: 15px;
      color: #555;
      font-style: italic;
      padding: 14px 16px;
      background: #fdfaf7;
      border-left: 4px solid #f4a261;
      border-radius: 8px;
      line-height: 1.6;
    }
    .note strong { color: #d35400; font-style: normal; }
    .no-results, .loader {
      text-align: center;
      padding: 40px 20px;
      color: #666;
      font-size: 16.5px;
      line-height: 1.6;
    }
    .error {
      color: #d32f2f;
      background: #ffebee;
      padding: 12px 16px;
      border-radius: 10px;
      margin: 16px 0;
      font-size: 15px;
      text-align: center;
    }
    @media (max-width: 380px) {
      .card { padding: 24px 20px; border-radius: 20px; }
      h1 { font-size: 23px; }
      .ingredients-grid { grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>
<body>

<div class="card">
  <h1>–†–µ—Ü–µ–ø—Ç—ã –ø–æ –∏–º–µ—é—â–∏–º—Å—è –ø—Ä–æ–¥—É–∫—Ç–∞–º</h1>

  <div class="section-title">–û—Ç–º–µ—Ç—å—Ç–µ, —á—Ç–æ –µ—Å—Ç—å –¥–æ–º–∞:</div>
  <div class="ingredients-grid" id="ingredientsList"></div>

  <button class="main-btn" id="findRecipesBtn" disabled>–ù–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Ä–µ—Ü–µ–ø—Ç—ã</button>
  <button class="secondary-btn" id="clearBtn">–°–±—Ä–æ—Å–∏—Ç—å –≤—ã–±–æ—Ä</button>

  <div id="results">
    <div class="loader" id="loader" style="display:none">–ü–æ–∏—Å–∫ —Ä–µ—Ü–µ–ø—Ç–æ–≤...</div>
  </div>
</div>

<script type="module">
// ‚îÄ‚îÄ‚îÄ –ù–ê–°–¢–†–û–ô–ö–ò ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const CATEGORIES = ['breakfast', 'lunch', 'dinner', 'soups', 'dessert'];

const POPULAR_INGREDIENTS = [
  "—è–π—Ü–∞", "–º–æ–ª–æ–∫–æ", "—Å–∞—Ö–∞—Ä", "–º—É–∫–∞", "–º–∞—Å–ª–æ —Å–ª–∏–≤–æ—á–Ω–æ–µ", "–º–∞—Å–ª–æ —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ–µ",
  "–∫—É—Ä–∏—Ü–∞", "–≥–æ–≤—è–¥–∏–Ω–∞", "—Å–≤–∏–Ω–∏–Ω–∞", "—Ä—ã–±–∞", "–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å", "–º–æ—Ä–∫–æ–≤—å", "–ª—É–∫",
  "–ø–æ–º–∏–¥–æ—Ä—ã", "–æ–≥—É—Ä—Ü—ã", "–∫–∞–ø—É—Å—Ç–∞", "—Ä–∏—Å", "–≥—Ä–µ—á–∫–∞", "–º–∞–∫–∞—Ä–æ–Ω—ã", "–æ–≤—Å—è–Ω–∫–∞",
  "—Ç–≤–æ—Ä–æ–≥", "—Å—ã—Ä", "—Å–º–µ—Ç–∞–Ω–∞", "–∫–µ—Ñ–∏—Ä", "–π–æ–≥—É—Ä—Ç", "—è–±–ª–æ–∫–∏", "–±–∞–Ω–∞–Ω—ã",
  "–∞–ø–µ–ª—å—Å–∏–Ω—ã", "–ª–∏–º–æ–Ω", "—á–µ—Å–Ω–æ–∫", "–∑–µ–ª–µ–Ω—å", "—É–∫—Ä–æ–ø", "–ø–µ—Ç—Ä—É—à–∫–∞", "—Å–ø–µ—Ü–∏–∏",
  "—Å–æ–ª—å", "–ø–µ—Ä–µ—Ü", "–º—ë–¥", "—à–æ–∫–æ–ª–∞–¥", "–∫–∞–∫–∞–æ", "—Ä–∞–∑—Ä—ã—Ö–ª–∏—Ç–µ–ª—å", "—Å–æ–¥–∞"
];

// ‚îÄ‚îÄ‚îÄ –≠–ª–µ–º–µ–Ω—Ç—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const ingListEl   = document.getElementById('ingredientsList');
const findBtn     = document.getElementById('findRecipesBtn');
const clearBtn    = document.getElementById('clearBtn');
const resultsEl   = document.getElementById('results');
const loaderEl    = document.getElementById('loader');

// ‚îÄ‚îÄ‚îÄ –°–æ—Å—Ç–æ—è–Ω–∏–µ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let selected = new Set();

// ‚îÄ‚îÄ‚îÄ –§—É–Ω–∫—Ü–∏–∏ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderIngredients() {
  ingListEl.innerHTML = '';
  POPULAR_INGREDIENTS.forEach(name => {
    const label = document.createElement('label');
    label.className = 'ingredient-item';

    const cb = document.createElement('input');
    cb.type = 'checkbox';
    cb.addEventListener('change', e => {
      if (e.target.checked) selected.add(name.toLowerCase());
      else                    selected.delete(name.toLowerCase());
      findBtn.disabled = selected.size === 0;
    });

    const span = document.createElement('span');
    span.textContent = name;

    label.append(cb, span);
    ingListEl.appendChild(label);
  });
}

async function loadAllRecipes() {
  const all = [];
  for (const cat of CATEGORIES) {
    try {
      const r = await fetch(`recipes/${cat}.json`);
      if (!r.ok) continue;
      const data = await r.json();
      data.forEach(recipe => { recipe.category = cat; });
      all.push(...data);
    } catch {}
  }
  return all;
}

function normalize(str) {
  return (str || '').toLowerCase()
    .replace(/—ë/g, '–µ')
    .replace(/[^–∞-—è0-9\s]/gi, '')
    .trim();
}

function matchesRecipe(recipe, selectedSet) {
  if (!recipe.ingredients?.length) return false;

  const recipeNorm = recipe.ingredients.map(i => normalize(i));

  let hitCount = 0;
  for (const s of selectedSet) {
    if (recipeNorm.some(r => r.includes(s) || s.includes(r))) hitCount++;
  }

  return hitCount / selectedSet.size >= 0.58;   // –ø–æ—Ä–æ–≥ –º–æ–∂–Ω–æ –ø–æ–¥–≤–∏–Ω—É—Ç—å
}

async function showMatchingRecipes() {
  if (selected.size === 0) return;

  resultsEl.innerHTML = '';
  loaderEl.style.display = 'block';
  findBtn.disabled = true;

  try {
    const allRecipes = await loadAllRecipes();
    const matches = allRecipes.filter(r => matchesRecipe(r, selected));

    loaderEl.style.display = 'none';

    if (!matches.length) {
      resultsEl.innerHTML = `
        <div class="no-results">
          –ü–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ üòî<br><br>
          –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–º–µ—Ç–∏—Ç—å –±–æ–ª—å—à–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
        </div>`;
      return;
    }

    const catNames = {
      breakfast: "–ó–∞–≤—Ç—Ä–∞–∫",
      lunch: "–û–±–µ–¥",
      dinner: "–£–∂–∏–Ω",
      soups: "–°—É–ø—ã",
      dessert: "–î–µ—Å–µ—Ä—Ç"
    };

    matches.forEach(r => {
      const card = document.createElement('div');
      card.className = 'recipe-card';

      card.innerHTML = `
        <div class="recipe-title">${r.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</div>
        <div class="recipe-meta">
          ${catNames[r.category] || r.category} ‚Ä¢ ${r.time || '?'} –º–∏–Ω ‚Ä¢ ${r.calories || '?'} –∫–∫–∞–ª
        </div>

        <div class="plain-list">
          <strong>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:</strong><br>
          ${r.ingredients.map(i => `‚Ä¢ ${i.trim()}`).join('<br>')}
        </div>

        <div class="plain-list">
          <strong>–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ:</strong><br>
          ${r.steps?.map((s,i) => `${i+1}. ${s.trim()}`).join('<br>') || '‚Äî'}
        </div>

        ${r.note ? `<div class="note"><strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong><br>${r.note.trim()}</div>` : ''}
      `;

      resultsEl.appendChild(card);
    });

  } catch (err) {
    console.error(err);
    loaderEl.style.display = 'none';
    resultsEl.innerHTML = '<div class="error">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç—ã</div>';
  } finally {
    findBtn.disabled = false;
  }
}

// ‚îÄ‚îÄ‚îÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.addEventListener('DOMContentLoaded', () => {
  renderIngredients();

  findBtn.onclick = showMatchingRecipes;
  clearBtn.onclick = () => {
    selected.clear();
    document.querySelectorAll('#ingredientsList input').forEach(el => el.checked = false);
    findBtn.disabled = true;
    resultsEl.innerHTML = '';
  };
});
</script>
</body>
</html>
