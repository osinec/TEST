<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>–ú–µ–Ω—é –Ω–∞ –Ω–µ–¥–µ–ª—é</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: linear-gradient(135deg, #ffecd2, #fcb69f);
      min-height: 100vh;
      color: #222;
      padding: 30px 16px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    .card {
      width: 100%;
      max-width: 720px;
      background: rgba(255,255,255,.96);
      border-radius: 26px;
      padding: 32px 24px;
      box-shadow: 0 30px 70px rgba(0,0,0,.18);
      margin: 0 auto;
    }
    h1 {
      text-align: center;
      font-size: 26px;
      font-weight: 700;
      color: #c7903d;
      margin-bottom: 32px;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 32px;
      justify-content: center;
    }
    button {
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      border: none;
      border-radius: 40px;
      font-weight: 600;
      transition: all .3s;
      padding: 16px 32px;
      font-size: 16px;
    }
    .main-btn {
      background: linear-gradient(135deg, #f6d365, #fda085);
      color: #222;
      min-width: 220px;
    }
    .main-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0,0,0,.15);
    }
    .back-btn {
      background: linear-gradient(135deg, #a1c4fd, #c2e9fb);
      color: #222;
      min-width: 220px;
    }
    .section-title {
      font-size: 18px;
      font-weight: 600;
      color: #333;
      margin: 24px 0 16px;
    }
    .settings {
      background: #fdfaf7;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 48px;          /* ‚Üê –∑–¥–µ—Å—å —É–≤–µ–ª–∏—á–µ–Ω –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É (–±—ã–ª–æ 32px) */
    }
    .meal-choices {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      margin-top: 16px;
    }
    .meal-option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      background: #ffffff;
      border-radius: 16px;
      border: 2px solid #eee;
      cursor: pointer;
      transition: all 0.25s ease;
      user-select: none;
      font-size: 15px;
      font-weight: 500;
      color: #444;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    .meal-option:hover {
      border-color: #f4a261;
      box-shadow: 0 6px 16px rgba(244,162,97,0.15);
      transform: translateY(-1px);
    }
    .meal-option.selected {
      background: linear-gradient(135deg, #fffaf0, #ffe8d1);
      border-color: #f4a261;
      color: #c7903d;
      font-weight: 600;
      box-shadow: 0 6px 18px rgba(244,162,97,0.2);
    }
    .meal-option input[type="checkbox"] {
      display: none;
    }
    .meal-icon {
      font-size: 22px;
      line-height: 1;
    }
    .menu-wrapper {
      overflow-x: auto;
      margin: 20px 0;
    }
    table {
      width: 100%;
      min-width: 600px;
      border-collapse: collapse;
      background: white;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    }
    th, td {
      padding: 12px 10px;
      text-align: center;
      border-bottom: 1px solid #eee;
      font-size: 15px;
    }
    th {
      background: #fdfaf7;
      color: #c7903d;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 13px;
    }
    .meal-row td:first-child {
      text-align: left;
      font-weight: 600;
      color: #444;
      background: #f9f9f9;
      padding-left: 16px;
    }
    .empty {
      text-align: center;
      padding: 60px 20px;
      color: #777;
      font-size: 16px;
      font-style: italic;
    }

    @media (max-width: 600px) {
      .card { padding: 24px 20px; }
      h1 { font-size: 24px; }
      .controls { flex-direction: column; }
      button { width: 100%; min-width: auto; }
      .meal-choices { grid-template-columns: 1fr; }
      th, td { font-size: 14px; padding: 10px 8px; }
    }
  </style>
</head>
<body>

<div class="card">
  <h1>–ú–µ–Ω—é –Ω–∞ –Ω–µ–¥–µ–ª—é</h1>

  <div class="settings">
    <div class="section-title">–ü—Ä–∏—ë–º—ã –ø–∏—â–∏</div>
    <div class="meal-choices">
      <label class="meal-option" id="label-breakfast">
        <input type="checkbox" id="chk-breakfast">
        <span class="meal-icon">‚òï</span> –ó–∞–≤—Ç—Ä–∞–∫
      </label>

      <label class="meal-option" id="label-soups">
        <input type="checkbox" id="chk-soups">
        <span class="meal-icon">ü•£</span> –ü–µ—Ä–≤–æ–µ
      </label>

      <label class="meal-option" id="label-lunch">
        <input type="checkbox" id="chk-lunch">
        <span class="meal-icon">üç≤</span> –í—Ç–æ—Ä–æ–µ
      </label>

      <label class="meal-option" id="label-dinner">
        <input type="checkbox" id="chk-dinner">
        <span class="meal-icon">üåô</span> –£–∂–∏–Ω
      </label>
    </div>
  </div>

  <div class="controls">
    <button class="main-btn" id="generateBtn">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å / –û–±–Ω–æ–≤–∏—Ç—å –º–µ–Ω—é</button>
    <button class="main-btn back-btn" onclick="window.location.href='index.html'">‚Üê –ù–∞–∑–∞–¥ –∫ —Ä–µ—Ü–µ–ø—Ç–∞–º</button>
  </div>

  <div id="loader" class="loader" style="display:none">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤...</div>
  <div id="error" class="error" style="display:none"></div>

  <div class="menu-wrapper">
    <div id="menuTable"></div>
  </div>
</div>

<script>
// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫—Ä–∞—Å–∏–≤—ã—Ö —á–µ–∫–±–æ–∫—Å–æ–≤
document.querySelectorAll('.meal-option').forEach(label => {
  const checkbox = label.querySelector('input[type="checkbox"]');
  const update = () => {
    if (checkbox.checked) {
      label.classList.add('selected');
    } else {
      label.classList.remove('selected');
    }
  };
  checkbox.addEventListener('change', update);
  update(); // –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
});

const DAYS = ["–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–í—Ç–æ—Ä–Ω–∏–∫", "–°—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä–≥", "–ü—è—Ç–Ω–∏—Ü–∞", "–°—É–±–±–æ—Ç–∞", "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"];
const SHORT_DAYS = ["–ü–ù", "–í–¢", "–°–†", "–ß–¢", "–ü–¢", "–°–ë", "–í–°"];

const MEAL_TYPES = [
  { key: "breakfast", title: "–ó–∞–≤—Ç—Ä–∞–∫", file: "breakfast" },
  { key: "soups",     title: "–ü–µ—Ä–≤–æ–µ",  file: "soups"     },
  { key: "lunch",     title: "–í—Ç–æ—Ä–æ–µ",  file: "lunch"     },
  { key: "dinner",    title: "–£–∂–∏–Ω",    file: "dinner"    }
];

let loadedRecipes = {};

async function loadCategory(file) {
  if (loadedRecipes[file]) return loadedRecipes[file];
  try {
    document.getElementById("loader").style.display = "block";
    const res = await fetch(`recipes/${file}.json`);
    if (!res.ok) throw new Error();
    const data = await res.json();
    loadedRecipes[file] = data;
    return data;
  } catch (err) {
    console.error(err);
    document.getElementById("error").textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç—ã";
    document.getElementById("error").style.display = "block";
    return [];
  } finally {
    document.getElementById("loader").style.display = "none";
  }
}

async function preloadNeededCategories() {
  const active = MEAL_TYPES.filter(m => document.getElementById(`chk-${m.key}`).checked);
  for (const meal of active) {
    await loadCategory(meal.file);
  }
}

function getActiveMealTypes() {
  return MEAL_TYPES.filter(m => document.getElementById(`chk-${m.key}`).checked);
}

function generateMenu() {
  const menu = {};
  const activeMeals = getActiveMealTypes();

  if (activeMeals.length === 0) {
    document.getElementById("menuTable").innerHTML = '<div class="empty">–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–∏—ë–º –ø–∏—â–∏</div>';
    return;
  }

  DAYS.forEach(day => {
    menu[day] = {};
    activeMeals.forEach(meal => {
      const recipes = loadedRecipes[meal.file] || [];
      if (recipes.length > 0) {
        const idx = Math.floor(Math.random() * recipes.length);
        menu[day][meal.key] = recipes[idx].title || "‚Äî";
      } else {
        menu[day][meal.key] = "‚Äî";
      }
    });
  });

  localStorage.setItem("weeklyMenu", JSON.stringify(menu));
  renderMenu(menu, activeMeals);
}

function renderMenu(menu, activeMeals) {
  let html = '<table><thead><tr><th></th>';
  SHORT_DAYS.forEach(d => html += `<th>${d}</th>`);
  html += '</tr></thead><tbody>';

  activeMeals.forEach(meal => {
    html += `<tr><td class="meal-row">${meal.title}</td>`;
    DAYS.forEach(day => {
      const title = menu[day]?.[meal.key] || "‚Äî";
      html += `<td>${title}</td>`;
    });
    html += '</tr>';
  });

  html += '</tbody></table>';

  document.getElementById("menuTable").innerHTML = html;
}

function loadSavedMenu() {
  const saved = localStorage.getItem("weeklyMenu");
  if (!saved) return null;
  try { return JSON.parse(saved); }
  catch { return null; }
}

// ‚îÄ‚îÄ‚îÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

document.addEventListener("DOMContentLoaded", async () => {
  const savedMenu = loadSavedMenu();
  const activeMeals = getActiveMealTypes();

  if (savedMenu && activeMeals.length > 0) {
    renderMenu(savedMenu, activeMeals);
  } else {
    document.getElementById("menuTable").innerHTML = '<div class="empty">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏—ë–º—ã –ø–∏—â–∏ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å / –û–±–Ω–æ–≤–∏—Ç—å –º–µ–Ω—é¬ª</div>';
  }

  document.getElementById("generateBtn").onclick = async () => {
    await preloadNeededCategories();
    generateMenu();
  };

  MEAL_TYPES.forEach(m => {
    document.getElementById(`chk-${m.key}`).onchange = () => {
      const saved = loadSavedMenu();
      if (saved) renderMenu(saved, getActiveMealTypes());
    };
  });
});
</script>
</body>
</html>
