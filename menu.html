<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>–ú–µ–Ω—é –Ω–∞ –Ω–µ–¥–µ–ª—é</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: linear-gradient(135deg, #ffecd2, #fcb69f);
      min-height: 100vh;
      color: #222;
      padding: 30px 16px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    .card {
      width: 100%;
      max-width: 720px;
      background: rgba(255,255,255,.96);
      border-radius: 26px;
      padding: 32px 24px;
      box-shadow: 0 30px 70px rgba(0,0,0,.18);
      margin: 0 auto;
    }
    h1 {
      text-align: center;
      font-size: 26px;
      font-weight: 700;
      color: #c7903d;
      margin-bottom: 32px;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 32px;
      justify-content: center;
    }
    button {
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      border: none;
      border-radius: 40px;
      font-weight: 600;
      transition: all .3s;
      padding: 16px 32px;
      font-size: 16px;
    }
    .main-btn {
      background: linear-gradient(135deg, #f6d365, #fda085);
      color: #222;
      min-width: 220px;
    }
    .main-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0,0,0,.15);
    }
    .back-btn {
      background: linear-gradient(135deg, #a1c4fd, #c2e9fb);
      color: #222;
      min-width: 220px;
    }
    .section-title {
      font-size: 18px;
      font-weight: 600;
      color: #333;
      margin: 24px 0 16px;
    }
    .settings {
      background: #fdfaf7;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 48px;
    }
    .meal-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    .meal-box {
      background: #ffffff;
      border-radius: 16px;
      border: 2px solid #eee;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      transition: all 0.25s ease;
      overflow: hidden;
      min-height: 100px;
    }
    .meal-box.active {
      border-color: #f4a261;
      background: linear-gradient(135deg, #fffaf0, #ffe8d1);
      box-shadow: 0 6px 18px rgba(244,162,97,0.2);
    }
    .meal-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 14px 10px 6px;
      cursor: pointer;
    }
    .meal-icon {
      font-size: 32px;
      margin-bottom: 6px;
    }
    .meal-name {
      font-size: 15px;
      font-weight: 600;
      color: #444;
      text-align: center;
    }
    .frequency-control {
      padding: 0 14px 12px;
      display: none;
    }
    .meal-box.active .frequency-control {
      display: block;
    }
    .frequency-label {
      font-size: 12px;
      color: #666;
      margin-bottom: 6px;
      text-align: center;
    }
    input[type="range"] {
      width: 100%;
      height: 8px;
      background: #ffe082;
      border-radius: 4px;
      outline: none;
      -webkit-appearance: none;
      transition: background 0.2s;
    }
    input[type="range"]:active {
      background: #ffca28;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      background: #ff9800;
      border-radius: 50%;
      cursor: grabbing;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      transition: transform 0.1s;
    }
    input[type="range"]:active::-webkit-slider-thumb {
      transform: scale(1.15);
    }
    input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: #ff9800;
      border-radius: 50%;
      cursor: grabbing;
      border: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    .frequency-value {
      font-size: 13px;
      font-weight: 600;
      color: #ef6c00;
      text-align: center;
      margin-top: 6px;
      min-width: 70px;
    }
    .menu-wrapper {
      overflow-x: auto;
      margin: 20px 0;
    }
    table {
      width: 100%;
      min-width: 600px;
      border-collapse: collapse;
      background: white;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    }
    th, td {
      padding: 12px 10px;
      text-align: center;
      border-bottom: 1px solid #eee;
      font-size: 15px;
    }
    th {
      background: #fdfaf7;
      color: #c7903d;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 13px;
    }
    .meal-row td:first-child {
      text-align: left;
      font-weight: 600;
      color: #444;
      background: #f9f9f9;
      padding-left: 16px;
    }
    .recipe-link {
      color: #c7903d;
      text-decoration: none;
      cursor: pointer;
      font-weight: 500;
      transition: color 0.2s;
    }
    .recipe-link:hover {
      color: #ef6c00;
      text-decoration: underline;
    }
    .empty {
      text-align: center;
      padding: 60px 20px;
      color: #777;
      font-size: 16px;
      font-style: italic;
    }
    .loader, .error {
      text-align: center;
      padding: 20px;
      color: #777;
      font-size: 16px;
    }
    .error { color: #d32f2f; }
    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ—Ü–µ–ø—Ç–∞ */
    .recipe-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(6px);
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 20px;
    }
    .recipe-modal-box {
      background: #fff;
      padding: 32px 28px;
      border-radius: 22px;
      width: 100%;
      max-width: 540px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      text-align: center;
    }
    .close-recipe {
      position: absolute;
      top: 12px; right: 14px;
      font-size: 26px;
      cursor: pointer;
      opacity: .6;
      transition: opacity 0.2s;
    }
    .close-recipe:hover { opacity: 1; }
    .recipe-photo {
      width: 100%;
      max-height: 280px;
      object-fit: cover;
      border-radius: 16px;
      margin: 12px 0 20px;
      background: #f0f0f0 url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%23e0e0e0"/></svg>') center/cover no-repeat;
    }
    .recipe-title {
      font-size: 24px;
      font-weight: 700;
      margin: 15px 0 20px;
      line-height: 1.3;
    }
    .recipe-section-title {
      text-align: left;
      font-size: 17px;
      font-weight: 600;
      color: #333;
      margin: 24px 0 12px;
    }
    .recipe-plain-list {
      text-align: left;
      font-size: 16px;
      line-height: 1.65;
      color: #333;
      margin: 0 0 24px 0;
      white-space: pre-wrap;
    }
    .recipe-note {
      text-align: left;
      margin-top: 20px;
      font-size: 15.5px;
      color: #555;
      font-style: italic;
      padding: 14px 16px;
      background: #fdfaf7;
      border-left: 4px solid #f4a261;
      border-radius: 8px;
      line-height: 1.6;
    }
    @media (max-width: 600px) {
      .card { padding: 24px 20px; }
      h1 { font-size: 24px; }
      .controls { flex-direction: column; }
      button { width: 100%; min-width: auto; }
      .meal-choices { grid-template-columns: 1fr; }
      th, td { font-size: 14px; padding: 10px 8px; }
    }
  </style>
</head>
<body>
<div class="card">
  <h1>–ú–µ–Ω—é –Ω–∞ –Ω–µ–¥–µ–ª—é</h1>
  <div class="settings">
    <div class="section-title">–ü—Ä–∏—ë–º—ã –ø–∏—â–∏</div>
    <div class="meal-choices meal-grid">
      <!-- –ó–∞–≤—Ç—Ä–∞–∫ -->
      <div class="meal-box" id="box-breakfast">
        <label class="meal-header" for="chk-breakfast">
          <input type="checkbox" id="chk-breakfast" style="display:none;">
          <span class="meal-icon">‚òï</span>
          <span class="meal-name">–ó–∞–≤—Ç—Ä–∞–∫</span>
        </label>
        <div class="frequency-control" id="freq-control-breakfast">
          <div class="frequency-label">–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é:</div>
          <input type="range" id="freq-breakfast" min="0" max="7" value="7" step="1">
          <div class="frequency-value" id="value-breakfast">7 —Ä–∞–∑</div>
        </div>
      </div>
      <!-- –ü–µ—Ä–≤–æ–µ -->
      <div class="meal-box" id="box-soups">
        <label class="meal-header" for="chk-soups">
          <input type="checkbox" id="chk-soups" style="display:none;">
          <span class="meal-icon">ü•£</span>
          <span class="meal-name">–ü–µ—Ä–≤–æ–µ</span>
        </label>
        <div class="frequency-control" id="freq-control-soups">
          <div class="frequency-label">–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é:</div>
          <input type="range" id="freq-soups" min="0" max="7" value="3" step="1">
          <div class="frequency-value" id="value-soups">3 —Ä–∞–∑–∞</div>
        </div>
      </div>
      <!-- –í—Ç–æ—Ä–æ–µ -->
      <div class="meal-box" id="box-lunch">
        <label class="meal-header" for="chk-lunch">
          <input type="checkbox" id="chk-lunch" style="display:none;">
          <span class="meal-icon">üç≤</span>
          <span class="meal-name">–í—Ç–æ—Ä–æ–µ</span>
        </label>
        <div class="frequency-control" id="freq-control-lunch">
          <div class="frequency-label">–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é:</div>
          <input type="range" id="freq-lunch" min="0" max="7" value="4" step="1">
          <div class="frequency-value" id="value-lunch">4 —Ä–∞–∑–∞</div>
        </div>
      </div>
      <!-- –£–∂–∏–Ω -->
      <div class="meal-box" id="box-dinner">
        <label class="meal-header" for="chk-dinner">
          <input type="checkbox" id="chk-dinner" style="display:none;">
          <span class="meal-icon">üåô</span>
          <span class="meal-name">–£–∂–∏–Ω</span>
        </label>
        <div class="frequency-control" id="freq-control-dinner">
          <div class="frequency-label">–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é:</div>
          <input type="range" id="freq-dinner" min="0" max="7" value="5" step="1">
          <div class="frequency-value" id="value-dinner">5 —Ä–∞–∑</div>
        </div>
      </div>
    </div>
  </div>
  <div class="controls">
    <button class="main-btn" id="generateBtn">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å / –û–±–Ω–æ–≤–∏—Ç—å –º–µ–Ω—é</button>
    <button class="main-btn back-btn" onclick="window.location.href='index.html'">‚Üê –ù–∞–∑–∞–¥ –∫ —Ä–µ—Ü–µ–ø—Ç–∞–º</button>
  </div>
  <div id="loader" class="loader" style="display:none">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤...</div>
  <div id="error" class="error" style="display:none"></div>
  <div class="menu-wrapper">
    <div id="menuTable"></div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ—Ü–µ–ø—Ç–∞ -->
<div class="recipe-modal" id="recipeModal">
  <div class="recipe-modal-box">
    <div class="close-recipe" id="closeRecipeBtn">‚úï</div>
    <h2 class="recipe-title" id="recipeTitle"></h2>
    <img id="recipePhoto" class="recipe-photo" alt="–§–æ—Ç–æ —Ä–µ—Ü–µ–ø—Ç–∞" loading="lazy" decoding="async">
    <div id="recipeIngredients"></div>
    <div id="recipeSteps"></div>
    <div id="recipeTime"></div>
    <div id="recipeCalories"></div>
    <div id="recipeNote" class="recipe-note"></div>
  </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ–∫–±–æ–∫—Å–∞–º–∏ –∏ —Å–ª–∞–π–¥–µ—Ä–∞–º–∏ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.querySelectorAll('.meal-box').forEach(box => {
  const checkbox = box.querySelector('input[type="checkbox"]');
  const freqControl = box.querySelector('.frequency-control');
  const slider = box.querySelector('input[type="range"]');
  const valueEl = box.querySelector('.frequency-value');

  const updateSliderText = () => {
    const val = parseInt(slider.value);
    valueEl.textContent = val === 0 ? '0 —Ä–∞–∑' : (val === 1 ? '1 —Ä–∞–∑' : `${val} —Ä–∞–∑`);
  };

  const update = () => {
    const isChecked = checkbox.checked;
    box.classList.toggle('active', isChecked);
    freqControl.style.display = isChecked ? 'block' : 'none';

    if (!isChecked) {
      slider.value = 0;
      updateSliderText();
    }
  };

  checkbox.addEventListener('change', update);

  // –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –ª—é–±–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏ –ø–æ–ª–∑—É–Ω–∫–∞
  slider.addEventListener('input', updateSliderText);

  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –æ—Ç–ø—É—Å–∫–∞–Ω–∏–∏ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
  slider.addEventListener('change', updateSliderText);

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  update();
  updateSliderText();
});

// ‚îÄ‚îÄ‚îÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ–Ω—é ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const DAYS = ["–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–í—Ç–æ—Ä–Ω–∏–∫", "–°—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä–≥", "–ü—è—Ç–Ω–∏—Ü–∞", "–°—É–±–±–æ—Ç–∞", "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"];
const SHORT_DAYS = ["–ü–ù", "–í–¢", "–°–†", "–ß–¢", "–ü–¢", "–°–ë", "–í–°"];
const MEAL_TYPES = [
  { key: "breakfast", title: "–ó–∞–≤—Ç—Ä–∞–∫", file: "breakfast" },
  { key: "soups",     title: "–ü–µ—Ä–≤–æ–µ",    file: "soups"     },
  { key: "lunch",     title: "–í—Ç–æ—Ä–æ–µ",    file: "lunch"     },
  { key: "dinner",    title: "–£–∂–∏–Ω",      file: "dinner"    }
];
let loadedRecipes = {};
const fallbackImage = 'data:image/svg+xml;utf8,<svg width="400" height="200" viewBox="0 0 400 200" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="400" height="200" fill="%23f0f0f0"/><text x="50%" y="50%" font-family="Inter" font-size="14" fill="%23888" text-anchor="middle" dy=".3em">–§–æ—Ç–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</text></svg>';

async function loadCategory(file) {
  if (loadedRecipes[file]) return loadedRecipes[file];
  try {
    document.getElementById("loader").style.display = "block";
    const res = await fetch(`recipes/${file}.json`);
    if (!res.ok) throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å ${file}.json`);
    const data = await res.json();
    loadedRecipes[file] = data;
    return data;
  } catch (err) {
    console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ${file}:`, err);
    document.getElementById("error").textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã";
    document.getElementById("error").style.display = "block";
    return [];
  } finally {
    document.getElementById("loader").style.display = "none";
  }
}

async function preloadNeededCategories() {
  const active = MEAL_TYPES.filter(m => document.getElementById(`chk-${m.key}`).checked);
  for (const meal of active) {
    await loadCategory(meal.file);
  }
}

function getActiveMealTypes() {
  return MEAL_TYPES.filter(m => document.getElementById(`chk-${m.key}`).checked);
}

function generateMenu() {
  const menu = {};
  const activeMeals = getActiveMealTypes();

  if (activeMeals.length === 0) {
    document.getElementById("menuTable").innerHTML = '<div class="empty">–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–∏—ë–º –ø–∏—â–∏</div>';
    return;
  }

  DAYS.forEach(day => {
    menu[day] = {};
    activeMeals.forEach(meal => {
      menu[day][meal.key] = "‚Äî";
    });
  });

  activeMeals.forEach(meal => {
    const slider = document.getElementById(`freq-${meal.key}`);
    const freq = slider ? parseInt(slider.value) : 0;
    if (freq <= 0) return;

    const recipes = loadedRecipes[meal.file] || [];
    if (recipes.length === 0) return;

    const selectedRecipes = [];
    const used = new Set();
    while (selectedRecipes.length < freq && used.size < recipes.length) {
      const idx = Math.floor(Math.random() * recipes.length);
      if (!used.has(idx)) {
        used.add(idx);
        selectedRecipes.push(recipes[idx].title.trim());
      }
    }

    const selectedDays = [];
    for (let i = 0; i < freq; i++) {
      const dayIndex = Math.floor(i * 7 / freq);
      selectedDays.push(dayIndex);
    }

    selectedDays.forEach((dayIndex, i) => {
      const day = DAYS[dayIndex];
      menu[day][meal.key] = selectedRecipes[i] || "‚Äî";
    });
  });

  localStorage.setItem("weeklyMenu", JSON.stringify(menu));
  renderMenu(menu, activeMeals);
}

function renderMenu(menu, activeMeals) {
  let html = '<table><thead><tr><th></th>';
  SHORT_DAYS.forEach(d => html += `<th>${d}</th>`);
  html += '</tr></thead><tbody>';
  activeMeals.forEach(meal => {
    html += `<tr><td class="meal-row">${meal.title}</td>`;
    DAYS.forEach(day => {
      const title = menu[day]?.[meal.key] || "‚Äî";
      html += `<td><span class="recipe-link" data-title="${title}" data-meal="${meal.key}">${title}</span></td>`;
    });
    html += '</tr>';
  });
  html += '</tbody></table>';
  document.getElementById("menuTable").innerHTML = html;

  document.querySelectorAll('.recipe-link').forEach(link => {
    link.addEventListener('click', (e) => {
      const title = e.target.dataset.title.trim();
      const mealKey = e.target.dataset.meal;
      if (title && title !== "‚Äî") {
        showRecipe(title, mealKey);
      }
    });
  });
}

function showRecipe(title, mealKey) {
  const recipes = loadedRecipes[mealKey] || [];
  const recipe = recipes.find(r => (r.title || '').trim() === title);
  if (!recipe) {
    alert('–†–µ—Ü–µ–ø—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
    return;
  }
  document.getElementById('recipeTitle').textContent = recipe.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
  const photoEl = document.getElementById('recipePhoto');
  photoEl.src = fallbackImage;
  if (recipe.photo) {
    const filename = recipe.photo.split('/').pop();
    const base = filename.replace(/\.(webp|png|jpg|jpeg)$/i, '');
    photoEl.src = `pics/${base}.webp`;
  }
  photoEl.onload = () => photoEl.classList.add('loaded');
  photoEl.onerror = () => photoEl.src = fallbackImage;

  document.getElementById('recipeIngredients').innerHTML = recipe.ingredients?.length
    ? `<div class="recipe-section-title">–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã:</div><div class="recipe-plain-list">${recipe.ingredients.map(i => i.trim()).join('<br>')}</div>`
    : '';

  document.getElementById('recipeSteps').innerHTML = recipe.steps?.length
    ? `<div class="recipe-section-title">–ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ:</div><div class="recipe-plain-list">${recipe.steps.map((s,i) => `${i+1}. ${s.trim()}`).join('<br>')}</div>`
    : '';

  document.getElementById('recipeTime').innerHTML = `<strong>–í—Ä–µ–º—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:</strong> ${recipe.time || '‚Äî'}`;
  document.getElementById('recipeCalories').innerHTML = `<strong>–ö–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å:</strong> ${recipe.calories || '‚Äî'} –∫–∫–∞–ª`;

  const noteEl = document.getElementById('recipeNote');
  if (recipe.note) {
    noteEl.innerHTML = `<strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong><br>${recipe.note.trim()}`;
    noteEl.style.display = 'block';
  } else {
    noteEl.style.display = 'none';
  }

  document.getElementById('recipeModal').style.display = 'flex';
  document.body.style.overflow = 'hidden';
}

function closeRecipeModal() {
  document.getElementById('recipeModal').style.display = 'none';
  document.body.style.overflow = 'auto';
}

function loadSavedMenu() {
  try {
    return JSON.parse(localStorage.getItem("weeklyMenu"));
  } catch {
    return null;
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.addEventListener("DOMContentLoaded", () => {
  const savedMenu = loadSavedMenu();
  const activeMeals = getActiveMealTypes();
  if (savedMenu && activeMeals.length > 0) {
    renderMenu(savedMenu, activeMeals);
  } else {
    document.getElementById("menuTable").innerHTML = '<div class="empty">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏—ë–º—ã –ø–∏—â–∏ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å / –û–±–Ω–æ–≤–∏—Ç—å –º–µ–Ω—é¬ª</div>';
  }

  document.getElementById("generateBtn").onclick = async () => {
    await preloadNeededCategories();
    generateMenu();
  };

  document.getElementById("closeRecipeBtn").onclick = closeRecipeModal;
  document.getElementById("recipeModal").onclick = e => {
    if (e.target === document.getElementById("recipeModal")) closeRecipeModal();
  };

  MEAL_TYPES.forEach(m => {
    const chk = document.getElementById(`chk-${m.key}`);
    if (chk) {
      chk.onchange = () => {
        const saved = loadSavedMenu();
        if (saved) renderMenu(saved, getActiveMealTypes());
      };
    }
  });
});
</script>
</body>
</html>
