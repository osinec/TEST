<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ Ñ€ĞµÑ†ĞµĞ¿Ñ‚Ğ¾Ğ²</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: linear-gradient(135deg, #ffecd2, #fcb69f);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      color: #222;
      padding: 30px;
    }
    .card {
      width: 100%;
      max-width: 540px;
      background: rgba(255,255,255,.96);
      border-radius: 26px;
      padding: 32px 28px;
      text-align: center;
      box-shadow: 0 30px 70px rgba(0,0,0,.18);
      margin: 0 auto;
    }
    button {
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      border: none;
      border-radius: 40px;
      font-weight: 600;
      transition: all .3s;
      -webkit-tap-highlight-color: transparent;
      position: relative;
    }
    .main-btn {
      padding: 20px 35px;
      background: linear-gradient(135deg,#f6d365,#fda085);
      font-size: 18px;
      color: #222;
      width: 100%;
      margin: 0 0 20px 0;
    }
    .main-btn:last-of-type {
      margin-bottom: 0;
    }
    .main-btn:hover, .main-btn:active {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0,0,0,.15);
    }
    .premium-btn {
      background: linear-gradient(135deg, #84fab0, #8fd3f4);
      color: #222;
      padding-right: 60px; /* Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿ ÑĞ¿Ñ€Ğ°Ğ²Ğ° Ğ´Ğ»Ñ ĞºĞ¾Ñ€Ğ¾Ğ½Ñ‹ */
    }
    .premium-badge {
      position: absolute;
      top: 50%;
      right: 18px;
      transform: translateY(-50%);
      font-size: 24px;
      color: #ffcc00;
      pointer-events: none;
      line-height: 1;
    }
    .refresh {
      display: none;
      margin-top: 15px;
      padding: 18px 30px;
      background: linear-gradient(135deg,#ff6a00,#ee0979);
      color: #fff;
      font-size: 17px;
      width: 100%;
    }
    .refresh:hover, .refresh:active {
      transform: translateY(-2px);
      box-shadow: 0 8px 15px rgba(238,9,121,.3);
    }
    .category {
      margin-top: 25px;
      font-size: 15px;
      letter-spacing: 2px;
      font-weight: 600;
      color: #c7903d;
      text-transform: uppercase;
    }
    h2 {
      margin: 15px 0 20px;
      font-size: 24px;
      font-weight: 700;
      line-height: 1.3;
    }
    #photo {
      width: 100%;
      height: 260px;
      object-fit: cover;
      border-radius: 16px;
      display: none;
      margin: 12px 0 20px;
      max-height: 35vh;
      background: #f8f1e9 url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%23e0d0c0"/><text x="50%" y="50%" font-family="Inter" font-size="12" fill="%23997" text-anchor="middle" dy=".3em">Ğ¤Ğ¾Ñ‚Ğ¾ Ğ±Ğ»ÑĞ´Ğ°</text></svg>') center/cover no-repeat;
      transition: opacity 0.3s ease;
    }
    #photo.loaded { opacity: 1; }
    .section-title {
      text-align: left;
      font-size: 17px;
      font-weight: 600;
      color: #333;
      margin: 24px 0 12px;
    }
    .plain-list {
      text-align: left;
      font-size: 16px;
      line-height: 1.65;
      color: #333;
      margin: 0 0 24px 0;
      white-space: pre-wrap;
    }
    .note {
      text-align: left;
      margin-top: 20px;
      font-size: 15.5px;
      color: #555;
      font-style: italic;
      padding: 14px 16px;
      background: #fdfaf7;
      border-left: 4px solid #f4a261;
      border-radius: 8px;
      line-height: 1.6;
    }
    .note strong { color: #d35400; font-style: normal; }
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(6px);
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 20px;
    }
    .modal-box {
      background: #fff;
      padding: 32px 28px;
      border-radius: 22px;
      width: 100%;
      max-width: 380px;
      position: relative;
      animation: modalAppear 0.3s ease;
    }
    @keyframes modalAppear {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .close {
      position: absolute;
      top: 12px; right: 14px;
      font-size: 26px;
      cursor: pointer;
      opacity: .6;
      transition: opacity 0.2s;
      width: 36px; height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .close:hover { opacity: 1; }
    .choice {
      width: 100%;
      margin-top: 18px;
      padding: 20px 15px;
      background: #f8f9fa;
      font-size: 17px;
      border-radius: 16px;
      transition: all 0.28s ease;
      text-align: left;
      border: 1px solid #eee;
    }
    .choice:hover {
      background: #f0f4f8;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .loader { display: none; text-align: center; padding: 30px; color: #666; font-size: 16px; }
    .error {
      color: #d32f2f;
      background: #ffebee;
      padding: 12px 16px;
      border-radius: 10px;
      margin-top: 12px;
      font-size: 15px;
      display: none;
    }
    #welcome-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.6);
      backdrop-filter: blur(5px);
      justify-content: center;
      align-items: center;
      z-index: 1100;
      padding: 20px;
    }
    #welcome-box {
      background: #ffffff;
      padding: 28px 24px;
      border-radius: 20px;
      width: 100%;
      max-width: 400px;
      position: relative;
      box-shadow: 0 20px 50px rgba(0,0,0,.25);
    }
    #welcome-text {
      font-size: 16px;
      line-height: 1.55;
      color: #333;
      margin-bottom: 20px;
    }
    #welcome-close {
      position: absolute;
      top: 12px;
      right: 16px;
      font-size: 28px;
      cursor: pointer;
      color: #777;
    }
    #welcome-close:hover {
      color: #222;
    }
    @media (max-width:360px) {
      .card { padding: 24px 18px; border-radius: 20px; }
      h2 { font-size: 22px; }
      #photo { height: 180px; }
    }
    @media (min-width:768px) {
      body { align-items: center; padding: 50px 30px; }
      .card { padding: 40px; }
    }
  </style>
</head>
<body>
<div class="card">
  <button class="main-btn" id="mainBtn">Ğ¡Ğ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¹ Ñ€ĞµÑ†ĞµĞ¿Ñ‚</button>
  <button class="main-btn premium-btn" id="menuBtn" onclick="window.location.href='menu.html'">
    ĞœĞµĞ½Ñ Ğ½Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ <span class="premium-badge">ğŸ‘‘</span>
  </button>
  <button class="main-btn premium-btn" id="ingredientsBtn" onclick="window.location.href='ingredients.html'">
    ĞŸĞ¾ Ğ¸Ğ½Ğ³Ñ€ĞµĞ´Ğ¸ĞµĞ½Ñ‚Ğ°Ğ¼ <span class="premium-badge">ğŸ‘‘</span>
  </button>
  <button class="refresh" id="refreshBtn">ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ€ĞµÑ†ĞµĞ¿Ñ‚ ğŸ”„</button>
  <div class="loader" id="loader">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ€ĞµÑ†ĞµĞ¿Ñ‚Ğ¾Ğ²...</div>
  <div class="error" id="error"></div>
  <div class="category" id="category"></div>
  <h2 id="title">Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ</h2>
  <img id="photo" alt="Ğ¤Ğ¾Ñ‚Ğ¾ Ñ€ĞµÑ†ĞµĞ¿Ñ‚Ğ°" loading="lazy" decoding="async">
  <div id="ingredients"></div>
  <div id="steps"></div>
  <div id="time"></div>
  <div id="calories"></div>
  <div id="note"></div>
</div>
<div class="modal" id="modal">
  <div class="modal-box">
    <div class="close" id="closeBtn">âœ•</div>
    <h3 style="margin-bottom:22px;font-size:22px">Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ</h3>
    <button class="choice" data-category="breakfast">Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ°Ğº</button>
    <button class="choice" data-category="lunch">ĞĞ±ĞµĞ´</button>
    <button class="choice" data-category="dinner">Ğ£Ğ¶Ğ¸Ğ½</button>
    <button class="choice" data-category="soups">Ğ¡ÑƒĞ¿Ñ‹</button>
    <button class="choice" data-category="dessert">Ğ”ĞµÑĞµÑ€Ñ‚</button>
  </div>
</div>
<div id="welcome-modal">
  <div id="welcome-box">
    <div id="welcome-close">âœ•</div>
    <div id="welcome-text">
      ĞŸÑ€Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¼ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ Ğ²ÑĞµ ĞºĞ°Ñ€Ñ‚Ğ¸Ğ½ĞºĞ¸ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ¿Ñ€ĞµĞ´Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹ (ÑÑ‚Ğ¾ Ğ·Ğ°Ğ¹Ğ¼Ñ‘Ñ‚ 2â€“5 ÑĞµĞºÑƒĞ½Ğ´).<br><br>
      ĞŸĞ¾ÑĞ»Ğµ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¼Ğ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ñ‹Ğ¼ ğŸ™‚
    </div>
  </div>
</div>
<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PocketBase SDK + Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const pb = new PocketBase('http://217.12.37.52:8090');

const elements = {
  modal: document.getElementById('modal'),
  mainBtn: document.getElementById('mainBtn'),
  menuBtn: document.getElementById('menuBtn'),
  ingredientsBtn: document.getElementById('ingredientsBtn'),
  refreshBtn: document.getElementById('refreshBtn'),
  closeBtn: document.getElementById('closeBtn'),
  loader: document.getElementById('loader'),
  error: document.getElementById('error'),
  category: document.getElementById('category'),
  title: document.getElementById('title'),
  photo: document.getElementById('photo'),
  ingredients: document.getElementById('ingredients'),
  steps: document.getElementById('steps'),
  time: document.getElementById('time'),
  calories: document.getElementById('calories'),
  note: document.getElementById('note'),
  welcomeModal: document.getElementById('welcome-modal'),
  welcomeClose: document.getElementById('welcome-close')
};

let loadedRecipes = {};
let currentCategory = null;
let recipeIndices = {};
let allPhotos = new Set();

const categoryNames = {
  breakfast: "Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ°Ğº",
  lunch: "ĞĞ±ĞµĞ´",
  dinner: "Ğ£Ğ¶Ğ¸Ğ½",
  soups: "Ğ¡ÑƒĞ¿Ñ‹",
  dessert: "Ğ”ĞµÑĞµÑ€Ñ‚"
};

const fallbackImage = 'data:image/svg+xml;utf8,<svg width="400" height="200" viewBox="0 0 400 200" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="400" height="200" fill="%23f8f1e9"/><text x="50%" y="45%" font-family="Inter" font-size="16" fill="%23997" text-anchor="middle">Ğ¤Ğ¾Ñ‚Ğ¾ Ğ±Ğ»ÑĞ´Ğ°</text><text x="50%" y="60%" font-family="Inter" font-size="13" fill="%23aaa" text-anchor="middle">(Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾)</text></svg>';

function showWelcomeIfFirstTime() {
  if (!localStorage.getItem('hasSeenWelcome')) {
    elements.welcomeModal.style.display = 'flex';
    localStorage.setItem('hasSeenWelcome', 'true');
  }
}

function closeWelcome() {
  elements.welcomeModal.style.display = 'none';
}

async function loadCategoryRecipes(category) {
  if (loadedRecipes[category]) return loadedRecipes[category];
  try {
    elements.loader.style.display = 'block';
    const response = await fetch(`recipes/${category}.json`);
    if (!response.ok) throw new Error(`HTTP ${response.status} Ğ´Ğ»Ñ ${category}`);
    const data = await response.json();
    loadedRecipes[category] = data;
    data.forEach(r => {
      if (r.photo) {
        const filename = r.photo.split('/').pop();
        const base = filename.replace(/\.(webp|png|jpg|jpeg)$/i, '');
        allPhotos.add(`pics/${base}.webp`);
      }
    });
    elements.loader.style.display = 'none';
    return data;
  } catch (err) {
    console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸:', category, err);
    elements.loader.style.display = 'none';
    elements.error.textContent = `ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ${categoryNames[category] || category}`;
    elements.error.style.display = 'block';
    return [];
  }
}

function preloadAllImages() {
  console.log(`ĞŸÑ€ĞµĞ´Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ ${allPhotos.size} webp-Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹...`);
  allPhotos.forEach(src => {
    const img = new Image();
    img.src = src;
  });
}

function openModal() {
  elements.modal.style.display = 'flex';
  document.body.style.overflow = 'hidden';
}

function closeModal() {
  elements.modal.style.display = 'none';
  document.body.style.overflow = 'auto';
}

function selectCategory(cat) {
  currentCategory = cat;
  closeModal();
  generateRecipe();
}

async function generateRecipe() {
  if (!currentCategory) return openModal();
  const recipes = await loadCategoryRecipes(currentCategory);
  if (!recipes?.length) {
    elements.error.textContent = 'Ğ ĞµÑ†ĞµĞ¿Ñ‚Ñ‹ Ğ² ÑÑ‚Ğ¾Ğ¹ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚';
    elements.error.style.display = 'block';
    elements.refreshBtn.style.display = 'none';
    return;
  }
  let idx = recipeIndices[currentCategory] || 0;
  recipeIndices[currentCategory] = (idx + 1) % recipes.length;
  updateUI(recipes[idx]);
  elements.refreshBtn.style.display = 'block';
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function updateUI(r) {
  elements.category.textContent = categoryNames[currentCategory]?.toUpperCase() || currentCategory.toUpperCase();
  elements.title.textContent = (r.title || 'Ğ‘ĞµĞ· Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ').trim();
  const photoEl = elements.photo;
  photoEl.classList.remove('loaded');
  photoEl.style.display = 'block';
  let photoSrc = fallbackImage;
  if (r.photo) {
    const filename = r.photo.split('/').pop();
    const base = filename.replace(/\.(webp|png|jpg|jpeg)$/i, '');
    photoSrc = `pics/${base}.webp`;
  }
  photoEl.src = photoSrc;
  photoEl.onload = () => photoEl.classList.add('loaded');
  photoEl.onerror = () => photoEl.src = fallbackImage;
  elements.ingredients.innerHTML = '';
  if (Array.isArray(r.ingredients) && r.ingredients.length) {
    elements.ingredients.innerHTML = `
      <div class="section-title">Ğ˜Ğ½Ğ³Ñ€ĞµĞ´Ğ¸ĞµĞ½Ñ‚Ñ‹:</div>
      <div class="plain-list">${r.ingredients.map(item => item.trim()).join('<br>')}</div>
    `;
  }
  elements.steps.innerHTML = '';
  if (Array.isArray(r.steps) && r.steps.length) {
    elements.steps.innerHTML = `
      <div class="section-title">ĞŸÑ€Ğ¸Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ:</div>
      <div class="plain-list">${r.steps.map((step, i) => `${i + 1}. ${step.trim()}`).join('<br>')}</div>
    `;
  }
  elements.time.innerHTML = `<strong>Ğ’Ñ€ĞµĞ¼Ñ Ğ¿Ñ€Ğ¸Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ:</strong> ${r.time || 'â€”'}`;
  elements.calories.innerHTML = `<strong>ĞšĞ°Ğ»Ğ¾Ñ€Ğ¸Ğ¹Ğ½Ğ¾ÑÑ‚ÑŒ:</strong> ${r.calories || 'â€”'} ĞºĞºĞ°Ğ»`;
  if (r.note) {
    elements.note.innerHTML = `<strong>ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ğµ:</strong><br>${r.note.trim()}`;
    elements.note.style.display = 'block';
  } else {
    elements.note.style.display = 'none';
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· PocketBase + Ğ¿Ñ€ĞµĞ¼Ğ¸ÑƒĞ¼-ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ñ ĞºĞ¾Ñ€Ğ¾Ğ½Ğ¾Ğ¹
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function updateUIState() {
  elements.mainBtn.style.display = 'block';

  if (!pb.authStore.isValid) {
    elements.menuBtn.querySelector('.premium-badge').style.display = 'inline';
    elements.ingredientsBtn.querySelector('.premium-badge').style.display = 'inline';
    elements.subscribeBtn.style.display = 'none';
    elements.logoutBtn.style.display = 'none';
    elements.mainBtn.disabled = false;
    elements.mainBtn.textContent = "Ğ¡Ğ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¹ Ñ€ĞµÑ†ĞµĞ¿Ñ‚ (Ğ²Ğ¾Ğ¹Ñ‚Ğ¸)";
    return;
  }

  elements.logoutBtn.style.display = 'block';

  const user = pb.authStore.model;
  const record = await pb.collection('users').getOne(user.id);

  if (record.is_subscribed) {
    elements.menuBtn.querySelector('.premium-badge').style.display = 'none';
    elements.ingredientsBtn.querySelector('.premium-badge').style.display = 'none';
    elements.subscribeBtn.style.display = 'none';
    elements.mainBtn.disabled = false;
    elements.mainBtn.textContent = "Ğ¡Ğ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¹ Ñ€ĞµÑ†ĞµĞ¿Ñ‚";
  } else {
    elements.menuBtn.querySelector('.premium-badge').style.display = 'inline';
    elements.ingredientsBtn.querySelector('.premium-badge').style.display = 'inline';
    elements.subscribeBtn.style.display = 'block';
    elements.mainBtn.disabled = true;
    elements.mainBtn.textContent = "Ğ¡Ğ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¹ Ñ€ĞµÑ†ĞµĞ¿Ñ‚ (Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ°)";
  }
}

async function signUp() {
  let email = elements.emailInput.value.trim();
  let password = elements.passwordInput.value.trim();

  if (!email.includes('@') || password.length < 6) {
    elements.error.textContent = "ĞĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¹ email Ğ¸Ğ»Ğ¸ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ ĞºĞ¾Ñ€Ğ¾Ñ‡Ğµ 6 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²";
    elements.error.style.display = 'block';
    return;
  }

  try {
    const user = await pb.collection('users').create({
      email: email,
      password: password,
      passwordConfirm: password,
    });

    await pb.collection('users').authWithPassword(email, password);
    closeAuthModal();
    await updateUIState();
  } catch (err) {
    elements.error.textContent = err.message || "ĞÑˆĞ¸Ğ±ĞºĞ° Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸";
    elements.error.style.display = 'block';
  }
}

async function signIn() {
  let email = elements.emailInput.value.trim();
  let password = elements.passwordInput.value.trim();

  try {
    const authData = await pb.collection('users').authWithPassword(email, password);
    closeAuthModal();
    await updateUIState();
  } catch (err) {
    elements.error.textContent = err.message || "ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ email Ğ¸Ğ»Ğ¸ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ";
    elements.error.style.display = 'block';
  }
}

async function logout() {
  pb.authStore.clear();
  await updateUIState();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

document.addEventListener('DOMContentLoaded', () => {
  elements.title.textContent = 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ';
  elements.photo.src = fallbackImage;

  elements.mainBtn.onclick = openModal;
  elements.refreshBtn.onclick = generateRecipe;
  elements.closeBtn.onclick = closeModal;

  document.querySelectorAll('.choice').forEach(btn => {
    btn.onclick = () => selectCategory(btn.dataset.category);
  });

  elements.modal.onclick = e => {
    if (e.target === elements.modal) closeModal();
  };

  document.onkeydown = e => {
    if (e.key === 'Escape' && elements.modal.style.display === 'flex') closeModal();
  };

  elements.welcomeClose.onclick = closeWelcome;
  elements.welcomeModal.onclick = e => {
    if (e.target === elements.welcomeModal) closeWelcome();
  };

  showWelcomeIfFirstTime();
  elements.refreshBtn.style.display = 'none';

  const preloadCheck = setInterval(() => {
    if (Object.keys(loadedRecipes).length > 0) {
      preloadAllImages();
      clearInterval(preloadCheck);
    }
  }, 800);

  // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹
  updateUIState();
});
</script>
</body>
</html>
